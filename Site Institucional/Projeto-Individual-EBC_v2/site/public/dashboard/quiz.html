<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/quiz.css">
    <link rel="icon" href="./img/military-hat.png">
    <script src="../js/funcoes.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>EBC | Quiz</title>
</head>

<body>

    <!-- HEADER -->

    <div class="fundo-quiz">
        <div class="header">
            <div class="container">
                <div class="titulo">
                    <img src="img/military-hat.png">
                    <h1>EBC</h1>
                </div>

                <ul class="navBar">
                    <li>
                        <a href="inicio.html">
                            Início
                        </a>
                    </li>

                    <li>
                        <a href="patentes.html">
                            Patentes
                        </a>
                    </li>

                    <li class="aqui">
                        <a href="quiz.html">
                            Quiz
                        </a>
                    </li>
                </ul>

                <ul class="register">
                    <li class="sair">
                        <span type="button" class="sair" onclick="limparSessao()">SAIR</span>
                    </li>
                </ul>

            </div>
        </div>
    </div>

    <!-- Banner -->
    <div id="meio1">

        <div class="meio">
            <div class="container-meio">
                <span>RESPONDA CORRETAMENTE E SUBA SUA PATENTE</span>
            </div>

            <div class="meio-texto">
                <button class="btn-quiz" onclick="comecar_quiz()">INICIAR JOGO</button>
            </div>
        </div>

        <div class="meio-carro" id="carror">
            <img src="img/tanque.gif" alt="">
        </div>
    </div>

    <!--Aqui está todo o Quiz-->
    <div id="meio2" style="display: none;">
        <div class="container-quiz">
            <div class="quiz">
                <div class="titulo">
                    <h1 id="titulo_quiz">Quiz</h1>
                </div>

                <!--Pergunta 1-->

                <div id="caixa1">
                    <div class="pergunta">
                        <span>Quem é o atual General do Exército Brasileiro?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="certa1()" value="Marco Antônio Freire">
                            <input type="button" class="inp_btn" onclick="errada1()" value="Carlos Roberto">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada1()" value="Paulo Guedes">
                            <input type="button" class="inp_btn" onclick="errada1()" value="Madureira">
                        </div>
                    </div>
                </div>

                <!--Pergunta 2-->

                <div id="caixa2" style="display: none;">

                    <div class="pergunta">
                        <span>O que signifia ESA?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada2()" value="Escola de SubTenentes">
                            <input type="button" class="inp_btn" onclick="errada2()" value="Escritório do Exército">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="certa2()"
                                value="Escola de Sargentos das Armas">
                            <input type="button" class="inp_btn" onclick="errada2()"
                                value="Escola de Sargentos das Américas">
                        </div>
                    </div>
                </div>

                <!--Pergunta 3-->

                <div id="caixa3" style="display: none;">

                    <div class="pergunta">
                        <span>O que significa EsPCEx?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="certa3()"
                                value="Escola Preparatória de Cadetes">
                            <input type="button" class="inp_btn" onclick="errada3()" value="Tiro de Guerra">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada3()" value="Estação Espacial X">
                            <input type="button" class="inp_btn" onclick="errada3()"
                                value="Escola de Pilotos do Exército">
                        </div>
                    </div>
                </div>

                <!--Pergunta 4-->

                <div id="caixa4" style="display: none;">

                    <div class="pergunta">
                        <span>Qual patente recebe o cidadão que esta cumprindo o seu periodo de instrução
                            obrigatório?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="certa4()" value="Atirador">
                            <input type="button" class="inp_btn" onclick="errada4()" value="Tenente">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada4()" value="Cabo">
                            <input type="button" class="inp_btn" onclick="errada4()" value="Major">
                        </div>
                    </div>
                </div>

                <!--Pergunta 5-->

                <div id="caixa5" style="display: none;">

                    <div class="pergunta">
                        <span>Qual o primeiro posto dos Oficiais Superiores?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada5()" value="Marechal">
                            <input type="button" class="inp_btn" onclick="certa5()" value="Major">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada5()" value="Tenente-Coronel">
                            <input type="button" class="inp_btn" onclick="errada5()" value="Coronel">
                        </div>
                    </div>
                </div>

                <!--Pergunta 6-->

                <div id="caixa6" style="display: none;">

                    <div class="pergunta">
                        <span>Qual a patente mais alta do exército brasileiro em tempos de guerra?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada6()" value="Coronel">
                            <input type="button" class="inp_btn" onclick="errada6()" value="General do Exército">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada6()" value="Cabo">
                            <input type="button" class="inp_btn" onclick="certa6()" value="Marechal">
                        </div>
                    </div>
                </div>

                <!--Pergunta 7-->

                <div id="caixa7" style="display: none;">

                    <div class="pergunta">
                        <span>A função primaria de um Cabo é comanda uma esquadra composta por?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada7()" value="1 Cabo e 2 Soldados">
                            <input type="button" class="inp_btn" onclick="certa7()" value="1 Cabo e 3 Soldados">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada7()" value="1 Cabo e 3 Sargentos">
                            <input type="button" class="inp_btn" onclick="errada7()" value="4 Soldados">
                        </div>
                    </div>
                </div>

                <!--Pergunta 8-->

                <div id="caixa8" style="display: none;">

                    <div class="pergunta">
                        <span>Qual a menor unidade militar, normalmente comandada por um Tenente?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada8()" value="Esquadra">
                            <input type="button" class="inp_btn" onclick="certa8()" value="Pelotão">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada8()" value="Batalão">
                            <input type="button" class="inp_btn" onclick="errada8()" value="Guarda">
                        </div>
                    </div>
                </div>

                <!--Pergunta 9-->

                <div id="caixa9" style="display: none;">

                    <div class="pergunta">
                        <span>Qual patente recebe a designação de "chefe de regimento militar"?</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada9()" value="Tenente-Coronel">
                            <input type="button" class="inp_btn" onclick="errada9()" value="Major">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="certa9()" value="Coronel">
                            <input type="button" class="inp_btn" onclick="errada9()" value="1°Tenente">
                        </div>
                    </div>
                </div>

                <!--Pergunta 10-->

                <div id="caixa10" style="display: none;">

                    <div class="pergunta">
                        <span>Qual o dia do Exército</span>
                    </div>
                    <div class="respostas">

                        <div class="resposta_esquerda">
                            <input type="button" class="inp_btn" onclick="errada10()" value="07 de Setembro">
                            <input type="button" class="inp_btn" onclick="errada10()" value="29 de Maio">
                        </div>
                        <div class="resposta_direita">
                            <input type="button" class="inp_btn" onclick="errada10()" value="9 de Julho">
                            <input type="button" class="inp_btn" onclick="certa10()" value="19 de Abril">
                        </div>
                    </div>

                </div>

                <!--Pergunta Tela Final-->

                <div id="resultado" style="display: none;" class="resultado">
                    <div class="metricas">
                        <h2>Parabens! Você finalizou o Quiz</h2>
                        <div class="pontos">
                            <h3>Pontos recebidos:</h3>
                            <h3 id="valor"></h3>
                        </div>
                    </div>


                    <div class="finalizar">
                        <a href="inicio.html">VOLTAR</a>
                        <span class="button" onclick="rank()">VER RANKING</span>
                    </div>
                </div>


                <!--RANK-->

                <div id="meio3" style="display: none;" class="meio3">                            
                    <div class="grafico">
                        <canvas id="myChart" width="400" height="210"></canvas>
                    </div>
                    <div class="finalizar">
                        <a href="inicio.html">VOLTAR</a>
                    </div>
                </div>

            </div>
        </div>

    </div>

</body>

</html>

<script>


    var ax_certa = 0
    var pontos = 0


    function comecar_quiz() {

        Swal.fire({
            html: '<h2 style="color: black;">Como Jogar!</h2><div><span>São 10 perguntas referente ao Exército Brasileiro e suas curiosidades, responda corretamente e suba sua patente com os pontos recebidos em cada partida!</span><br><br><br><br><div style="display: flex; justify-items: center; justify-content: space-between; width: 100%;"><div style="display:grid; justify-items: center; text-align: center; width: 30%;"><span style="margin-bottom: 15px;">Todos começam de baixo, apenas como um soldado</span> <img src="./img/soldado.png"  alt=""> SOLDADO </div> <div style="display:grid; justify-items: center; text-align: center; width: 30%;"><span style="margin-bottom: 15px;">Suba pelos postos de hierarquia com o seu própio esforço e mérito</span> <img src="./img/capitao.png"  alt=""> CAPITÃO </div> <div style="display:grid; justify-items: center; text-align: center; width: 30%;"><span style="margin-bottom: 15px;">Conquiste a tão sonhada patente de Marechal</span> <img src="./img/marechal.gif"  alt=""> MARECHAL </div></div> <br><br><br><span>Confira a hierarquia militar e os pontos necessários para cada posto na nossa tela de Patentes, e fique de olho no nosso ranking de jogadores <br><br> Boa Sorte!</span></div>',
            background: 'white',
            width: '75%',
            
        })
        
        meio1.style.display = `none`
        meio2.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 1 de 10`

    }
    

    function certa1() {
        caixa1.style.display = `none`
        caixa2.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 2 de 10`
        ax_certa++;
    }

    function errada1() {
        caixa1.style.display = `none`
        caixa2.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 2 de 10`
    }

    function certa2() {
        caixa2.style.display = `none`
        caixa3.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 3 de 10`
        ax_certa++;
    }

    function errada2() {
        caixa2.style.display = `none`
        caixa3.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 3 de 10`
    }

    function certa3() {
        caixa3.style.display = `none`
        caixa4.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 4 de 10`
        ax_certa++;
    }

    function errada3() {
        caixa3.style.display = `none`
        caixa4.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 4 de 10`
    }

    function certa4() {
        caixa4.style.display = `none`
        caixa5.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 5 de 10`
        ax_certa++;
    }

    function errada4() {
        caixa4.style.display = `none`
        caixa5.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 5 de 10`
    }

    function certa5() {
        caixa5.style.display = `none`
        caixa6.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 6 de 10`
        ax_certa++;
    }

    function errada5() {
        caixa5.style.display = `none`
        caixa6.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 6 de 10`
    }

    function certa6() {
        caixa6.style.display = `none`
        caixa7.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 7 de 10`
        ax_certa++;
    }

    function errada6() {
        caixa6.style.display = `none`
        caixa7.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 7 de 10`
    }

    function certa7() {
        caixa7.style.display = `none`
        caixa8.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 8 de 10`
        ax_certa++;
    }

    function errada7() {
        caixa7.style.display = `none`
        caixa8.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 8 de 10`
    }

    function certa8() {
        caixa8.style.display = `none`
        caixa9.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 9 de 10`
        ax_certa++;
    }

    function errada8() {
        caixa8.style.display = `none`
        caixa9.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 9 de 10`
    }

    function certa9() {
        caixa9.style.display = `none`
        caixa10.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 10 de 10`
        ax_certa++;
    }

    function errada9() {
        caixa9.style.display = `none`
        caixa10.style.display = `block`
        titulo_quiz.innerHTML = `Pergunta 10 de 10`
    }

    function certa10() {
        caixa10.style.display = `none`
        resultado.style.display = `block`
        titulo_quiz.innerHTML = `Resultado`

        ax_certa++;
        pontos = ax_certa * 10

        valor.innerHTML = pontos
        registrarPontos()
    }

    function errada10() {
        caixa10.style.display = `none`
        resultado.style.display = `block`
        titulo_quiz.innerHTML = `Resultado`

        pontos = ax_certa * 10
        valor.innerHTML = pontos

        registrarPontos()
    }

    // fetch que registra os pontos ganhos do Quiz no banco de dados
    function registrarPontos() {


        fetch("/usuarios/registrarPontos", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                pontosServer: pontos,
                idServer: sessionStorage.ID_USUARIO
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert(`OK`)

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

    }

    function rank() {
        
        
        fetch("/medidas/pegarRankUsuarios", {
        method: 'POST',
        headers: {
            "Content-Type": "application/json"
        }
    }).then(function (resposta) {
        if (resposta.ok) {
            resposta.json().then(json => {
                console.log(`json`, json)

                var vt_rankPontos = []
                var vt_rankNome = []


                for (var ax_contador = 0; ax_contador < json.length; ax_contador++) {
                    
                    var rankPontos = json[ax_contador].pontos
                    var rankNome = json[ax_contador].nome
                    vt_rankPontos.push(rankPontos)
                    vt_rankNome.push(rankNome)

                    console.log(vt_rankNome)
                    console.log(vt_rankPontos)
                }

                gerarGrafico(vt_rankNome, vt_rankPontos)

            })
        }
    })
}

    function gerarGrafico(vt_rankNome, vt_rankPontos) {

        resultado.style.display = `none`
        meio3.style.display = `block`
        titulo_quiz.innerHTML = `Ranking de Jogadores`
        
        
        const data = {
        labels: vt_rankNome,
        datasets: [{
            label: 'Pontos',
            backgroundColor: `rgba(46, 204, 113, 1)`,
            borderColor: `rgba(46, 204, 113, 1)`,
            data: vt_rankPontos,
        },
        ]
    };

    const config = {  
        type: 'bar',
        data: data,
        options: {
            scales: {
                y: {
                    min: 0,
                }
            }
        }
    };

    const myChart = new Chart(
        document.getElementById('myChart'),
        config
        );

    }




    var x = 0
    var y = 2

    function Movercarro() {
        y = y + 2
        x = `${y}px`

        document.getElementsByClassName("meio-carro")[0].style.marginLeft = `${x}`;

        if (y == 1300) {
            y = -300

        }

    }
    setInterval(Movercarro, 20);
</script>